sequenceDiagram
    participant Timer as â° Timer (5min)
    participant LA as ðŸ”„ Logic App
    participant Azure as â˜ï¸ Azure API
    participant PBI as ðŸ“Š Power BI API
    participant Fabric as ðŸ­ Fabric Capacity
    participant Email as ðŸ“§ Office 365
    participant AI as ðŸ“ App Insights

    Timer->>LA: Trigger

    par Get Data
        LA->>Azure: GET Current SKU
        Azure-->>LA: F1024
        LA->>PBI: DAX Query (CU% + Capacity ID filter)
        PBI-->>LA: CurrentCU: 85%
        LA->>PBI: DAX Query (Avg45 + Capacity ID filter)
        PBI-->>LA: AvgCU45: 72%
        LA->>PBI: DAX Query (Throttle + Capacity ID filter)
        PBI-->>LA: ThrottleCount: 0, RejectionPct: 0%
    end

    LA->>LA: Decision Engine
    Note over LA: CU=85%, Avg=72%<br/>ThrottleCount=0 (filtered)<br/>F1024 threshold: 75%/85%<br/>â†’ Scale Up!

    LA->>Fabric: PATCH SKU â†’ F2048
    alt Scale Success
        Fabric-->>LA: 200 OK
        LA->>Email: Send Success Alert
    else Quota Limit
        Fabric-->>LA: 400 BadRequest (Quota)
        LA->>Email: Send Blocked Alert
    end

    LA->>AI: Log Event (Decision + Metrics)
